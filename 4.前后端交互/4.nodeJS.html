<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>4.nodeJS | GGS DDU</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="GGS DDU">
    <link rel="preload" href="/index/assets/css/0.styles.5331c3bc.css" as="style"><link rel="preload" href="/index/assets/js/app.9915e749.js" as="script"><link rel="preload" href="/index/assets/js/2.6552fd95.js" as="script"><link rel="preload" href="/index/assets/js/36.3b3a3740.js" as="script"><link rel="prefetch" href="/index/assets/js/10.54b794c8.js"><link rel="prefetch" href="/index/assets/js/11.14c22ce7.js"><link rel="prefetch" href="/index/assets/js/12.e3224cb5.js"><link rel="prefetch" href="/index/assets/js/13.36729f04.js"><link rel="prefetch" href="/index/assets/js/14.80c31306.js"><link rel="prefetch" href="/index/assets/js/15.32de8c8a.js"><link rel="prefetch" href="/index/assets/js/16.404663dd.js"><link rel="prefetch" href="/index/assets/js/17.efabd7a9.js"><link rel="prefetch" href="/index/assets/js/18.0b696e7a.js"><link rel="prefetch" href="/index/assets/js/19.048b44c9.js"><link rel="prefetch" href="/index/assets/js/20.e1b59749.js"><link rel="prefetch" href="/index/assets/js/21.9932956b.js"><link rel="prefetch" href="/index/assets/js/22.3efa7569.js"><link rel="prefetch" href="/index/assets/js/23.d90b8421.js"><link rel="prefetch" href="/index/assets/js/24.73c9aea6.js"><link rel="prefetch" href="/index/assets/js/25.d766cbc1.js"><link rel="prefetch" href="/index/assets/js/26.75e74a7a.js"><link rel="prefetch" href="/index/assets/js/27.c5d91bd4.js"><link rel="prefetch" href="/index/assets/js/28.50921aa3.js"><link rel="prefetch" href="/index/assets/js/29.06dd4398.js"><link rel="prefetch" href="/index/assets/js/3.7a5ae64e.js"><link rel="prefetch" href="/index/assets/js/30.b5057867.js"><link rel="prefetch" href="/index/assets/js/31.6f41dec4.js"><link rel="prefetch" href="/index/assets/js/32.71cee19b.js"><link rel="prefetch" href="/index/assets/js/33.7434fcd4.js"><link rel="prefetch" href="/index/assets/js/34.0d5baca1.js"><link rel="prefetch" href="/index/assets/js/35.423582c7.js"><link rel="prefetch" href="/index/assets/js/37.457f484b.js"><link rel="prefetch" href="/index/assets/js/38.f5cdcf22.js"><link rel="prefetch" href="/index/assets/js/39.1b29ce18.js"><link rel="prefetch" href="/index/assets/js/4.a551fda6.js"><link rel="prefetch" href="/index/assets/js/40.da723c05.js"><link rel="prefetch" href="/index/assets/js/41.38cf67dc.js"><link rel="prefetch" href="/index/assets/js/42.64745509.js"><link rel="prefetch" href="/index/assets/js/43.08777138.js"><link rel="prefetch" href="/index/assets/js/44.a8d4bc4b.js"><link rel="prefetch" href="/index/assets/js/45.f6baf106.js"><link rel="prefetch" href="/index/assets/js/46.60ad6dec.js"><link rel="prefetch" href="/index/assets/js/47.33409ee4.js"><link rel="prefetch" href="/index/assets/js/48.fdc17f16.js"><link rel="prefetch" href="/index/assets/js/49.24ad2e90.js"><link rel="prefetch" href="/index/assets/js/5.9751f667.js"><link rel="prefetch" href="/index/assets/js/50.976ed520.js"><link rel="prefetch" href="/index/assets/js/51.76633c94.js"><link rel="prefetch" href="/index/assets/js/52.7d095590.js"><link rel="prefetch" href="/index/assets/js/53.ef65abdb.js"><link rel="prefetch" href="/index/assets/js/54.c9d8d01f.js"><link rel="prefetch" href="/index/assets/js/55.5887f80a.js"><link rel="prefetch" href="/index/assets/js/56.b38a017c.js"><link rel="prefetch" href="/index/assets/js/57.29636d08.js"><link rel="prefetch" href="/index/assets/js/58.5b98d662.js"><link rel="prefetch" href="/index/assets/js/59.8207af43.js"><link rel="prefetch" href="/index/assets/js/6.981a9465.js"><link rel="prefetch" href="/index/assets/js/60.567f44b4.js"><link rel="prefetch" href="/index/assets/js/61.6dc27254.js"><link rel="prefetch" href="/index/assets/js/62.b7ac1dd3.js"><link rel="prefetch" href="/index/assets/js/63.7b75705a.js"><link rel="prefetch" href="/index/assets/js/64.57b86c3d.js"><link rel="prefetch" href="/index/assets/js/65.79cfa2e1.js"><link rel="prefetch" href="/index/assets/js/7.c4d8d391.js"><link rel="prefetch" href="/index/assets/js/8.2758da50.js"><link rel="prefetch" href="/index/assets/js/9.648cff9b.js">
    <link rel="stylesheet" href="/index/assets/css/0.styles.5331c3bc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/index/" class="home-link router-link-active"><!----> <span class="site-name">GGS DDU</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>1.html</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2.css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>3.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>4.前后端交互</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/index/4.前后端交互/1.常见概念.html" class="sidebar-link">1.常见概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/index/4.前后端交互/1.常见概念.html#hash" class="sidebar-link">Hash</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/1.常见概念.html#jsonp跨域" class="sidebar-link">JSONP跨域</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/1.常见概念.html#后端相关" class="sidebar-link">后端相关</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/1.常见概念.html#api风格" class="sidebar-link">API风格</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/1.常见概念.html#mime" class="sidebar-link">MIME</a></li></ul></li><li><a href="/index/4.前后端交互/2.http.html" class="sidebar-link">2.http</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#服务器" class="sidebar-link">服务器</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#前端和服务器端" class="sidebar-link">前端和服务器端</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#网络通信协议" class="sidebar-link">网络通信协议</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#http" class="sidebar-link">HTTP</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#url详解" class="sidebar-link">URL详解</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#状态码" class="sidebar-link">状态码</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#请求类型" class="sidebar-link">请求类型</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#缓存机制" class="sidebar-link">缓存机制</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#http2-0" class="sidebar-link">HTTP2.0</a></li></ul></li><li><a href="/index/4.前后端交互/3.ajax.html" class="sidebar-link">3.ajax</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/index/4.前后端交互/3.ajax.html#ajax" class="sidebar-link">ajax</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/3.ajax.html#转码" class="sidebar-link">转码</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/3.ajax.html#json" class="sidebar-link">JSON</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/3.ajax.html#模板引擎" class="sidebar-link">模板引擎</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/3.ajax.html#cookie和session的node-js实现" class="sidebar-link">Cookie和Session的Node.js实现</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/3.ajax.html#加密" class="sidebar-link">加密</a></li></ul></li><li><a href="/index/4.前后端交互/4.nodeJS.html" class="active sidebar-link">4.nodeJS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/index/4.前后端交互/4.nodeJS.html#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/4.nodeJS.html#nodejs的性质" class="sidebar-link">NodeJS的性质</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/4.nodeJS.html#nodejs服务器路由" class="sidebar-link">NodeJS服务器路由</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/4.nodeJS.html#模块" class="sidebar-link">模块</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/4.nodeJS.html#路由和映射" class="sidebar-link">路由和映射</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/4.nodeJS.html#get请求和post请求" class="sidebar-link">GET请求和POST请求</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/4.nodeJS.html#自定义模块" class="sidebar-link">自定义模块</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/4.nodeJS.html#node进程管理pm2和node版本管理nvm" class="sidebar-link">Node进程管理pm2和Node版本管理nvm</a></li></ul></li><li><a href="/index/4.前后端交互/5.MongoDB.html" class="sidebar-link">5.MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/index/4.前后端交互/5.MongoDB.html#nosql数据库" class="sidebar-link">NoSQL数据库</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/5.MongoDB.html#mongodb" class="sidebar-link">MongoDB</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/5.MongoDB.html#需要重新学习" class="sidebar-link">需要重新学习</a></li></ul></li><li><a href="/index/4.前后端交互/6.前端渲染.html" class="sidebar-link">6.前端渲染</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/index/4.前后端交互/6.前端渲染.html#常见方案" class="sidebar-link">常见方案</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>5.前端框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>6.前端工程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>7.计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>8.各种必会方案</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>9.必会面试题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>10.方法论</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_4-nodejs"><a href="#_4-nodejs" class="header-anchor">#</a> 4.nodeJS</h1> <p>在Java、PHP或者.net等服务器端语言中，会为每一个客户端连接创建一个新的线程。而每个进程需要耗费大约2MB内存。也就是说，理论上一个8GB内存的服务器可以同时连接的最大用户数为4000个左右。</p> <p>Node.js不为每个客户连接创建一个新的线程，而仅仅使用一个线程。</p> <p>单线程的带来的好处，还有操作系统完全不再有线程创建、销毁的时间开销。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意：要区别线程和进程的区别，NodeJS的服务是单线程的，但是一台物理服务器开一开启多个进程，运行多个Node服务器程序，但是彼此之间是独立的。</p></div> <h2 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h2> <p>基于ChromeV8引擎的 JavaScript 运行环境，一个事件驱动、非阻塞式(异步)I/O的模型;
<strong>单线程是任务按照顺序执行的，并且每次只执行一个任务</strong></p> <ul><li>事件驱动编程主要思想是通过事件或状态的变化来进行应用程序的流程控制。事件通过异步方式去执行，事件执行完毕调用回调函数；</li> <li>异步I/O，读写文件/操作是异步的。JS是单线程的，异步事件通过回调函数重新进入线程执行当前事件后面的业务流程，非常适合I/O密集(I/O并发量高)的场景。</li> <li>NodeJS的包生态系统，npm是最大的开源库的生态系统；</li></ul> <p>所以，NodeJS不适合做重度计算，重度计算会阻塞线程。
Node.js也非常适合与web socket配合，开发长连接的实时交互应用程序。
也可以作为API服务器，转发请求到业务服务器。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 证明给node是单线程的：</span>
<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a<span class="token operator">+=</span><span class="token number">1</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">,</span> 'localhost’<span class="token punctuation">)</span>
<span class="token comment">// a是累加的，每人访问的都是同一个a</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// NodeJS仅仅有一个线程，必须异步I/O。</span>
<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 得到用户IP</span>
<span class="token keyword">var</span> thisIp <span class="token operator">=</span> req<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>remoteAddress
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>thisIp <span class="token operator">+</span> <span class="token string">'用户来读取数据'</span><span class="token punctuation">)</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'1.html'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>thisIp <span class="token operator">+</span> <span class="token string">'用户读取完毕'</span><span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">,</span> <span class="token string">'localhost'</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 得到用户IP</span>
    <span class="token keyword">var</span> thisIp <span class="token operator">=</span> req<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>remoteAddress
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>thisIp <span class="token operator">+</span> <span class="token string">'用户来了，给他计算100000以内的质数个数'</span><span class="token punctuation">)</span>
    <span class="token comment">// 大量计算，阻塞线程</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> i <span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            count<span class="token operator">++</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result<span class="token operator">++</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>thisIp <span class="token operator">+</span> <span class="token string">'用户计算完了'</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'100000以内的个数是'</span> <span class="token operator">+</span> result<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">,</span> <span class="token string">'localhost'</span><span class="token punctuation">)</span>
</code></pre></div><p>Node.js为性能而生。Node.js的底层代码是C++，并且底层中的绝大部分代码是V8引擎的代码。</p> <h2 id="nodejs的性质"><a href="#nodejs的性质" class="header-anchor">#</a> NodeJS的性质</h2> <p><strong>前端非常适合学习node.js，走向全栈工程师</strong></p> <p><strong>要有全栈思维</strong></p> <p>前端工程师关心界面的UI、交互等逻辑；
后端的东西就是HTTP请求、post请求、get请求、数据库的CRUD、cookie、session。后端其他语言能做的，node都能做。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用NodeJS创建一个本地服务器</span>
<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html;charset=UTF-8'</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">,</span> 'localhost’<span class="token punctuation">)</span>
<span class="token comment">// 浏览器中访问127.0.0.1:8888或者localhost:8888，可以看到Hello World</span>
</code></pre></div><p>Node.js没有使用传统的Apache、Nginx、IIS等HTTP服务器，不用建设在任何服务器软件之上。Node.js的许多设计理念与经典架构（LAMP）有着很大的不同，可以提供强大的伸缩能力。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用NodeJS搭建服务器，读取并发送html页面</span>
<span class="token comment">// http是NodeJS内置的提供http功能的模块，require是NodeJS内置函数，专门负责引用模块</span>
<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token comment">// fs是NodeJS内置的文件操作的模块</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 读取文件转为二进制buffer</span>
<span class="token comment">// 要在终端所在的路径，为根路径</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'test.html'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">,</span> <span class="token string">'localhost'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="nodejs服务器路由"><a href="#nodejs服务器路由" class="header-anchor">#</a> NodeJS服务器路由</h2> <p>与静态文件的地址不一样，服务路由可以指定路径/功能；</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 要在终端所在的路径，为根路径</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html;charset=UTF-8'</span><span class="token punctuation">)</span>
    <span class="token comment">// req中是每次访问的用户的请求的相关信息</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'/1'</span><span class="token operator">:</span>
            fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'1.html'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">case</span> <span class="token string">'/2'</span><span class="token operator">:</span>
            fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'2.html'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'1.html'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">,</span> <span class="token string">'localhost'</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="模块"><a href="#模块" class="header-anchor">#</a> 模块</h2> <ul><li>url模块。url.parse()方法，可以拆分一个长URL变为一个个部分，比如url是：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// http://127.0.0.1:3800/a/b.html?xingming=%E5%B0%8F%E6%98%8E&amp;age=12#4</span>
<span class="token comment">// 红色部分是pathname 蓝色部分是search 绿色部分是hash</span>
url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
</code></pre></div><ul><li>Path模块。path.basename() 提炼url中的文件名部分；path.dirname() 提炼url中的文件夹部分；path.extname() 提炼url中的拓展名部分。比如url是 http://127.0.0.1:3800/a/b/c.html  ，此时三部分分别是:c.html、/a/b、.html。 path.normalize() 智能规整url。</li></ul> <h2 id="路由和映射"><a href="#路由和映射" class="header-anchor">#</a> 路由和映射</h2> <p>路由和映射，就是URL和物理文件的映射关系。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 获取路径信息</span>
<span class="token keyword">var</span> pathname <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>pathname
<span class="token comment">// 用正则校验是否是8位学号</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> pathname<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/^\/student\/([\d]{8})$/</span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> xuehao <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html;charset=UTF-8'</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'&lt;h1&gt;xx管理系统&lt;/h1&gt;&lt;h3&gt;你要查询的学号为'</span> <span class="token operator">+</span> xuehao <span class="token operator">+</span> <span class="token string">'&lt;/h3&gt;'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这实际上就是RESTful风格的路由：对同一个用户的CRUD操作，都是用同一个URL，比如都是  http://127.0.0.1:3800/student/12312315 ，如果要显示他的信息，此时用GET请求请求这个路径。如果要删除这个学生，此时用delete请求请求这个路径即可。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// http://127.0.0.1:3800/view.php?id=23423423</span>
<span class="token comment">// http://127.0.0.1:3800/del.php?id=23423423</span>
<span class="token comment">// http://127.0.0.1:3800/update.php?id=23423423</span>
</code></pre></div><p>express路由清单中 / 指的是从端口地址出发，是一个绝对路径；__dirName(全局变量)获取当前模块文件所在目录的完整绝对路径。</p> <h2 id="get请求和post请求"><a href="#get请求和post请求" class="header-anchor">#</a> GET请求和POST请求</h2> <p>GET请求的参数如何获得，实际上就是URL的解析。Node中的一个module(模块)叫做url，可以把URL进行parse，其中的query部分，就是querystring。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// http://127.0.0.1:3800/?id=1&amp;xingming=%E5%B0%8F%E6%98%8E&amp;age=12</span>
<span class="token keyword">var</span> query <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>query
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>     
<span class="token comment">// id=1&amp;xingming=%E5%B0%8F%E6%98%8E&amp;age=12</span>
<span class="token comment">// 使用内置模块querystring，不常用</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>       
<span class="token comment">// {id: 1, xingming: '小明', age: 12}</span>
<span class="token comment">// 常用：</span>
<span class="token keyword">var</span> query <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>query
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>    
<span class="token comment">// {id: 1, xingming: '小明', age: 12}</span>
</code></pre></div><p>POST请求一般用来发送比较大量的内容，如果上传1G的内容，nodeJS为了不阻塞js进程，会把内容分成一个个包来进行接收，此时一个包传输完毕，就是一个切断点，nodejs就能给别的人提供服务。所以nodejs中反而post请求效率极高。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> http <span class="token keyword">from</span> <span class="token string">'http'</span>
<span class="token keyword">import</span> url <span class="token keyword">from</span> <span class="token string">'url'</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token comment">// NodeJS使用监听的方式来处理post请求时</span>
    <span class="token comment">// data表示一个事件，表示一个小包传输完毕的动作，req.on可以监听每个小包，并提供api做回调</span>
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'小包传输完毕'</span><span class="token punctuation">)</span>
        result<span class="token operator">+=</span> chunk
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// end表示整体传输完毕的动作，提供回调</span>
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">,</span> <span class="token string">'localhost'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="自定义模块"><a href="#自定义模块" class="header-anchor">#</a> 自定义模块</h2> <p>NodeJS工程使用CMD规范，一个文件可以看作一个一个模块，每一个js文件就是一个独立的作用域。模块可以将我们的业务进行分割，模块就是独立的逻辑体系。
使用哪一个模块就require这个文件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">require</span> <span class="token punctuation">(</span><span class="token string">'./a.js'</span><span class="token punctuation">)</span> <span class="token comment">// 在a文件中定义一个变量m</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token comment">// 报错</span>
<span class="token comment">// 引用的a.js文件里面有异步语句，没有关系，此时还是不会等待异步语句执行完毕，会直接执行引用文件里面的其他语句。</span>
</code></pre></div><p>模块向外暴露方法用exports。如果一个js文件中的变量、函数想要暴露到外面，此时就要使用exports内置对象：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// a.js</span>
exports<span class="token punctuation">.</span>m <span class="token operator">=</span> <span class="token number">100</span>
exports<span class="token punctuation">.</span>n <span class="token operator">=</span> <span class="token number">99</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">fun</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dfg'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// b.js</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./a.js'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>m<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>n<span class="token punctuation">)</span>
a<span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>约定俗成的习惯，就是js文件叫什么名字，就用什么变量接收。比如外面是a.js，所以引用的时候就要使用a来接收。一个js文件仅仅向外暴露一个东西，此时为了方便，node可以使用module.exports的写法。特别常用于构造函数（类）的暴露。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// people.js</span>
<span class="token keyword">function</span> <span class="token function">People</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    thia<span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age
<span class="token punctuation">}</span>
<span class="token class-name">People</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">my name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> People
<span class="token comment">// main.js</span>
<span class="token keyword">var</span> People <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./people.js'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> xiaoming <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
xiaoming<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>  A文件可以require B，B也可以require C。但是node会自动阻止环装引用，就是A引用B，B也引用A，node会自动阻止。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// a1引用的是同一个目录下的a.js文件</span>
<span class="token keyword">var</span> a1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./a.js'</span><span class="token punctuation">)</span>
<span class="token comment">// a2引用的是node_modules文件夹下的a文件夹里面的index.js文件</span>
<span class="token keyword">var</span> a2 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token comment">// a3引用的是node_modules文件夹下的a.js文件</span>
<span class="token keyword">var</span> a3 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'a.js'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="node进程管理pm2和node版本管理nvm"><a href="#node进程管理pm2和node版本管理nvm" class="header-anchor">#</a> Node进程管理pm2和Node版本管理nvm</h2> <p>NodeJs的特殊文件夹：node_modules文件夹</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/index/4.前后端交互/3.ajax.html" class="prev">
        3.ajax
      </a></span> <span class="next"><a href="/index/4.前后端交互/5.MongoDB.html">
        5.MongoDB
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/index/assets/js/app.9915e749.js" defer></script><script src="/index/assets/js/2.6552fd95.js" defer></script><script src="/index/assets/js/36.3b3a3740.js" defer></script>
  </body>
</html>
