<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3.ajax | GGS DDU</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="GGS DDU">
    <link rel="preload" href="/index/assets/css/0.styles.5331c3bc.css" as="style"><link rel="preload" href="/index/assets/js/app.9915e749.js" as="script"><link rel="preload" href="/index/assets/js/2.6552fd95.js" as="script"><link rel="preload" href="/index/assets/js/12.e3224cb5.js" as="script"><link rel="prefetch" href="/index/assets/js/10.54b794c8.js"><link rel="prefetch" href="/index/assets/js/11.14c22ce7.js"><link rel="prefetch" href="/index/assets/js/13.36729f04.js"><link rel="prefetch" href="/index/assets/js/14.80c31306.js"><link rel="prefetch" href="/index/assets/js/15.32de8c8a.js"><link rel="prefetch" href="/index/assets/js/16.404663dd.js"><link rel="prefetch" href="/index/assets/js/17.efabd7a9.js"><link rel="prefetch" href="/index/assets/js/18.0b696e7a.js"><link rel="prefetch" href="/index/assets/js/19.048b44c9.js"><link rel="prefetch" href="/index/assets/js/20.e1b59749.js"><link rel="prefetch" href="/index/assets/js/21.9932956b.js"><link rel="prefetch" href="/index/assets/js/22.3efa7569.js"><link rel="prefetch" href="/index/assets/js/23.d90b8421.js"><link rel="prefetch" href="/index/assets/js/24.73c9aea6.js"><link rel="prefetch" href="/index/assets/js/25.d766cbc1.js"><link rel="prefetch" href="/index/assets/js/26.75e74a7a.js"><link rel="prefetch" href="/index/assets/js/27.c5d91bd4.js"><link rel="prefetch" href="/index/assets/js/28.50921aa3.js"><link rel="prefetch" href="/index/assets/js/29.06dd4398.js"><link rel="prefetch" href="/index/assets/js/3.7a5ae64e.js"><link rel="prefetch" href="/index/assets/js/30.b5057867.js"><link rel="prefetch" href="/index/assets/js/31.6f41dec4.js"><link rel="prefetch" href="/index/assets/js/32.71cee19b.js"><link rel="prefetch" href="/index/assets/js/33.7434fcd4.js"><link rel="prefetch" href="/index/assets/js/34.0d5baca1.js"><link rel="prefetch" href="/index/assets/js/35.423582c7.js"><link rel="prefetch" href="/index/assets/js/36.3b3a3740.js"><link rel="prefetch" href="/index/assets/js/37.457f484b.js"><link rel="prefetch" href="/index/assets/js/38.f5cdcf22.js"><link rel="prefetch" href="/index/assets/js/39.1b29ce18.js"><link rel="prefetch" href="/index/assets/js/4.a551fda6.js"><link rel="prefetch" href="/index/assets/js/40.da723c05.js"><link rel="prefetch" href="/index/assets/js/41.38cf67dc.js"><link rel="prefetch" href="/index/assets/js/42.64745509.js"><link rel="prefetch" href="/index/assets/js/43.08777138.js"><link rel="prefetch" href="/index/assets/js/44.a8d4bc4b.js"><link rel="prefetch" href="/index/assets/js/45.f6baf106.js"><link rel="prefetch" href="/index/assets/js/46.60ad6dec.js"><link rel="prefetch" href="/index/assets/js/47.33409ee4.js"><link rel="prefetch" href="/index/assets/js/48.fdc17f16.js"><link rel="prefetch" href="/index/assets/js/49.24ad2e90.js"><link rel="prefetch" href="/index/assets/js/5.9751f667.js"><link rel="prefetch" href="/index/assets/js/50.976ed520.js"><link rel="prefetch" href="/index/assets/js/51.76633c94.js"><link rel="prefetch" href="/index/assets/js/52.7d095590.js"><link rel="prefetch" href="/index/assets/js/53.ef65abdb.js"><link rel="prefetch" href="/index/assets/js/54.c9d8d01f.js"><link rel="prefetch" href="/index/assets/js/55.5887f80a.js"><link rel="prefetch" href="/index/assets/js/56.b38a017c.js"><link rel="prefetch" href="/index/assets/js/57.29636d08.js"><link rel="prefetch" href="/index/assets/js/58.5b98d662.js"><link rel="prefetch" href="/index/assets/js/59.8207af43.js"><link rel="prefetch" href="/index/assets/js/6.981a9465.js"><link rel="prefetch" href="/index/assets/js/60.567f44b4.js"><link rel="prefetch" href="/index/assets/js/61.6dc27254.js"><link rel="prefetch" href="/index/assets/js/62.b7ac1dd3.js"><link rel="prefetch" href="/index/assets/js/63.7b75705a.js"><link rel="prefetch" href="/index/assets/js/64.57b86c3d.js"><link rel="prefetch" href="/index/assets/js/65.79cfa2e1.js"><link rel="prefetch" href="/index/assets/js/7.c4d8d391.js"><link rel="prefetch" href="/index/assets/js/8.2758da50.js"><link rel="prefetch" href="/index/assets/js/9.648cff9b.js">
    <link rel="stylesheet" href="/index/assets/css/0.styles.5331c3bc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/index/" class="home-link router-link-active"><!----> <span class="site-name">GGS DDU</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>1.html</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2.css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>3.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>4.前后端交互</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/index/4.前后端交互/1.常见概念.html" class="sidebar-link">1.常见概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/index/4.前后端交互/1.常见概念.html#hash" class="sidebar-link">Hash</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/1.常见概念.html#jsonp跨域" class="sidebar-link">JSONP跨域</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/1.常见概念.html#后端相关" class="sidebar-link">后端相关</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/1.常见概念.html#api风格" class="sidebar-link">API风格</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/1.常见概念.html#mime" class="sidebar-link">MIME</a></li></ul></li><li><a href="/index/4.前后端交互/2.http.html" class="sidebar-link">2.http</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#服务器" class="sidebar-link">服务器</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#前端和服务器端" class="sidebar-link">前端和服务器端</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#网络通信协议" class="sidebar-link">网络通信协议</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#http" class="sidebar-link">HTTP</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#url详解" class="sidebar-link">URL详解</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#状态码" class="sidebar-link">状态码</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#请求类型" class="sidebar-link">请求类型</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#缓存机制" class="sidebar-link">缓存机制</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/2.http.html#http2-0" class="sidebar-link">HTTP2.0</a></li></ul></li><li><a href="/index/4.前后端交互/3.ajax.html" class="active sidebar-link">3.ajax</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/index/4.前后端交互/3.ajax.html#ajax" class="sidebar-link">ajax</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/3.ajax.html#转码" class="sidebar-link">转码</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/3.ajax.html#json" class="sidebar-link">JSON</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/3.ajax.html#模板引擎" class="sidebar-link">模板引擎</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/3.ajax.html#cookie和session的node-js实现" class="sidebar-link">Cookie和Session的Node.js实现</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/3.ajax.html#加密" class="sidebar-link">加密</a></li></ul></li><li><a href="/index/4.前后端交互/4.nodeJS.html" class="sidebar-link">4.nodeJS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/index/4.前后端交互/4.nodeJS.html#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/4.nodeJS.html#nodejs的性质" class="sidebar-link">NodeJS的性质</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/4.nodeJS.html#nodejs服务器路由" class="sidebar-link">NodeJS服务器路由</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/4.nodeJS.html#模块" class="sidebar-link">模块</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/4.nodeJS.html#路由和映射" class="sidebar-link">路由和映射</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/4.nodeJS.html#get请求和post请求" class="sidebar-link">GET请求和POST请求</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/4.nodeJS.html#自定义模块" class="sidebar-link">自定义模块</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/4.nodeJS.html#node进程管理pm2和node版本管理nvm" class="sidebar-link">Node进程管理pm2和Node版本管理nvm</a></li></ul></li><li><a href="/index/4.前后端交互/5.MongoDB.html" class="sidebar-link">5.MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/index/4.前后端交互/5.MongoDB.html#nosql数据库" class="sidebar-link">NoSQL数据库</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/5.MongoDB.html#mongodb" class="sidebar-link">MongoDB</a></li><li class="sidebar-sub-header"><a href="/index/4.前后端交互/5.MongoDB.html#需要重新学习" class="sidebar-link">需要重新学习</a></li></ul></li><li><a href="/index/4.前后端交互/6.前端渲染.html" class="sidebar-link">6.前端渲染</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/index/4.前后端交互/6.前端渲染.html#常见方案" class="sidebar-link">常见方案</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>5.前端框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>6.前端工程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>7.计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>8.各种必会方案</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>9.必会面试题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>10.方法论</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_3-ajax"><a href="#_3-ajax" class="header-anchor">#</a> 3.ajax</h1> <h2 id="ajax"><a href="#ajax" class="header-anchor">#</a> ajax</h2> <p>浏览器不刷新页面的情况下，向服务器传递带有参数的HTTP请求，服务器传回响应，通过JS局部刷新页面，还可以支持前台后台共同配合开发的方式。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Ajax技术，Asynchronous Javascript and XML。异步Javascript和XML，让客户端异步访问服务器的一整套技术；
Ajax是一组技术，是HTML、CSS、DOM相关技术的综合；
主要是使用XMLHttpRequest，js中的内置构造函数来实现。
区别于DOM事件，DOM事件不属于异步语句。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// jQuery实现Ajax：</span>
$<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url <span class="token operator">+</span> params<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// function cb(data)</span>
$<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">...</span>params<span class="token punctuation">}</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span>
</code></pre></div><p>原生JS实现Ajax，原生Ajax的实现:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// XMLHttpRequest不兼容IE6</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>XMLHttpRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// IE6</span>
    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span><span class="token string">'Msxml2.XMLHTTP'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 返回数据使用回调函数处理</span>
            <span class="token function">cb</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 配置一个请求；</span>
<span class="token comment">// type: get/post/put...</span>
<span class="token comment">// isAsync: 是否异步</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> url<span class="token punctuation">,</span> isAsync<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 发送上行报文体：get请求默认为null；post上行请求的报文体是传输的参数；</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="转码"><a href="#转码" class="header-anchor">#</a> 转码</h2> <p>转码，字符转码的问题、用JSON来转为query string。观察一个事情，此时在地址栏中输入‘你好‘：
<img src="/index/assets/img/4.3.1.88ca2b51.png" width="300"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 复制出来：</span>
<span class="token string">'http://127.0.0.1/test.txt?%E4%BD%A0%E5%A5%BD'</span>
</code></pre></div><p>这是URI转码（Uniform Resource Identifier，统一资源标识符），URI和URL差不多，只不过URL强调的是地址，URI强调的是具体的写法。因为网址只能是英语字符和数字，不能是中文、日语、韩语、阿拉伯文等等，所以URI就想了个办法，用16进制数字来表示非英语文字。</p> <p>JavaScript内置了转码的函数，各个浏览器兼容很好：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 从中文 → URI编码：</span>
<span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token string">&quot;我爱你&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// URL编码 → 中文：</span>
<span class="token function">decodeURIComponent</span><span class="token punctuation">(</span><span class="token string">&quot;%E4%BD%A0%E5%A5%BD&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>主要是为了防止在传输过程中非英语文字变形，用的临时编码。为了防止传输过程中变形</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>
    <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;check.php?yonghuming=&quot;</span> 
        <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>yonghuming<span class="token punctuation">)</span> <span class="token operator">+</span> 
        <span class="token string">&quot;&amp;age=&quot;</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>在对URL进行内容拆分或者组装params到URL上的时候，要对非英文进行解码/编码才能使用；</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// URL上的params：</span>
<span class="token punctuation">{</span>
    <span class="token string">&quot;yonghuming&quot;</span><span class="token operator">:</span> <span class="token string">&quot;小明&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
    <span class="token string">&quot;sex&quot;</span><span class="token operator">:</span> <span class="token string">&quot;男&quot;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 返回</span>
<span class="token string">&quot;?yonghuming=%E5%B0%8F%E6%98%8E&amp;age=12&amp;sex=%E7%94%B7&quot;</span>
<span class="token comment">// 使用数组的join方法。</span>
<span class="token keyword">function</span> <span class="token function">changeJSON2QueryString</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">JSON</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> temp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> k <span class="token keyword">in</span> <span class="token constant">JSON</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        temp<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> temp<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="json"><a href="#json" class="header-anchor">#</a> JSON</h2> <p><strong>JSON是一个通用的信息交换的格式，在JS中表现为一个严格对象</strong>
Ajax技术来读取一个服务器发回的JSON时，读进来的是JSON字符串；
要把字符串变为对象，有三种方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// JSON.parse()函数里面的字符串必须是标准JSON，必须有双引号引用所有的key。</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 字符串 → 对象</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 对象 → 字符串</span>
<span class="token comment">// 最外层用单引号，里面用双引号</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'{&quot;a&quot;: 1}'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> dataobj <span class="token operator">=</span> <span class="token keyword">typeof</span> dataobj <span class="token operator">==</span> <span class="token string">&quot;Object&quot;</span> <span class="token operator">?</span> data <span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment">// ②低版本浏览器（IE6，7）可以使用使用eval语句（好用，但不常用）；</span>
<span class="token comment">// eval语句可以把字符串变为语句，是JS中的一个特色；但是，eval()一般都是当做奇淫技巧使用，注意任何文本框都需要用正则表达式阻止eval；</span>
<span class="token comment">// 我们可以利用eval语句来把JSON字符串变为对象的JSON，但是此时要注意：如果直接eval一个JSON字符串，会报错；语法要求必须用圆括号括起来；</span>
<span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">'({&quot;a&quot;: 1})'</span><span class="token punctuation">)</span>
<span class="token comment">// {a: 1}</span>
<span class="token comment">// ③用Function函数（不常用）</span>
<span class="token comment">// Function也可以把字符串变为语句</span>
<span class="token keyword">var</span> dataobj <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">&quot;return &quot;</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dataobj<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> dataobj<span class="token punctuation">)</span>
</code></pre></div><h2 id="模板引擎"><a href="#模板引擎" class="header-anchor">#</a> 模板引擎</h2> <p>JS中模版引擎指的是，将指定的模板内容（字符串）中带有特定标记的元素（子字符串）替换一下便生成最终需要的业务（网页表现）；其实质是对大量重复的DOM结构中不同的显示内容，进行匹配和替换；基础的替换原理是用正则表达式进行匹配和替换，比如:replace。</p> <blockquote><p>  分为四步走：</p></blockquote> <ul><li>准备模板字符串，就是含有模板标记的字符串（不同的框架，有不同的标记方式）模板标记内是一个K；</li> <li>准备字典（一般是JSON/对象数据），K就是标记的K；</li> <li>数据绑定，字典的V去匹配标记的K；</li> <li>模版上树；</li></ul> <p>underscore提供了自己的模板，_.template（模板字符串（注意：HTML文件本身就是字符串，比如大盒子套小盒子，大盒子.innerHTML的类型就是字符串），回调函数）；</p> <p>给回调函数传参数，参数就是准备好的字典；字典的K：V对不能少于模板标记的个数，特殊功能或者个案的标记要在前面进行设置。</p> <h2 id="cookie和session的node-js实现"><a href="#cookie和session的node-js实现" class="header-anchor">#</a> Cookie和Session的Node.js实现</h2> <ul><li>Cookie：当服务器在HTTP响应头部下发了一个Set-Cookie，后面每次Request浏览器都会带着相同的cookie上去。</li> <li>Seesion：服务器端的cookie叫session。</li> <li>cookie是不发送明文，而是特定的随机码。 服务器就会比较这个乱码和之前谁的一样，就是哪个用户。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在Express中使用cookie：</span>
<span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'rememberme'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>expires<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">900000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> httpOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>服务端给客户端设置cookie之后，这个客户端后面每次同域请求都会带上这个cookie。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在Express中使用cookie：</span>
<span class="token comment">// session使用第三方中间件，叫做express-session。</span>
<span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-session'</span><span class="token punctuation">)</span>

<span class="token comment">// express中使用中间件，按照顺序session必须放在最前面</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    secret<span class="token operator">:</span> <span class="token string">'my-session'</span><span class="token punctuation">,</span> <span class="token comment">// 加密字符串，随机乱码是在这个字符的基础上加密的</span>
    resave<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    saveUninitialized<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 设置cookie</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> sess <span class="token operator">=</span> req<span class="token punctuation">.</span>session
    session<span class="token punctuation">.</span>a <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 设置session</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'ok,已经记录a为'</span> <span class="token operator">+</span> session<span class="token punctuation">.</span>a<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/home'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> sess <span class="token operator">=</span> req<span class="token punctuation">.</span>session<span class="token punctuation">,</span> str
    <span class="token keyword">if</span><span class="token punctuation">(</span>sess<span class="token punctuation">.</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        str <span class="token operator">=</span> <span class="token string">'不存在'</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        str <span class="token operator">=</span> sess<span class="token punctuation">.</span>a<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 读取session</span>
    <span class="token punctuation">}</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="加密"><a href="#加密" class="header-anchor">#</a> 加密</h2> <p><strong>不能在数据库中用明文存密码</strong></p> <p>使用明文，如果你的数据库丢失，或者员工故意泄密，应为用户的QQ、Email等可能是同一个密码。</p> <p>所以，应该先把密码加密，然后把加密生成的字符存储在数据库中；用户登陆的时候，再把输入的密码进行同样规范的加密，比对数据库中的字符，来判断密码是否正确。</p> <blockquote><p>  最著名的两套加密算法分别是SHA系列、MD5系列，都是著名的单向算法，仅仅能够从明文计算出密文，你不可能找到一个方法从密文计算出明文。也就是说SHA、MD5都是用来加密的，而他们没有解密功能。</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/index/4.前后端交互/2.http.html" class="prev">
        2.http
      </a></span> <span class="next"><a href="/index/4.前后端交互/4.nodeJS.html">
        4.nodeJS
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/index/assets/js/app.9915e749.js" defer></script><script src="/index/assets/js/2.6552fd95.js" defer></script><script src="/index/assets/js/12.e3224cb5.js" defer></script>
  </body>
</html>
